---
interface Props {
  series: {
    title: string;
    order?: number;
  };
  currentSlug: string;
}

import { getCollection } from 'astro:content';
import Heading from '../ui/Heading.astro';

const { series, currentSlug } = Astro.props;

const allNotes = await getCollection('notes');
const seriesNotes = allNotes
  .filter((n) => n.data.series?.title === series.title)
  .sort((a, b) => (a.data.series?.order || 0) - (b.data.series?.order || 0));

const currentIndex = seriesNotes.findIndex((n) => n.slug === currentSlug);
---

<div class="rounded-lg border bg-card text-card-foreground shadow-sm">
  <div class="flex flex-col space-y-1.5 p-6">
    <div class="text-sm font-medium text-muted-foreground uppercase tracking-wider">
        Series
    </div>
    <Heading level="h3" class="text-lg font-semibold leading-none tracking-tight">
        {series.title}
    </Heading>
    <p class="text-sm text-muted-foreground">
        Part {currentIndex + 1} of {seriesNotes.length}
    </p>
  </div>

  <div class="p-6 pt-0">
    <ol class="space-y-4 border-l border-muted-foreground/40 ml-2">
        {seriesNotes.map((note, index) => {
            const isCurrent = note.slug === currentSlug;
            return (
                <li class="relative pl-6">
                    <span class={`absolute -left-1.5 top-1.5 h-3 w-3 rounded-full border border-background ${isCurrent ? 'bg-primary' : 'bg-muted-foreground'}`}></span>
                    {isCurrent ? (
                        <span class="text-sm font-medium text-foreground">
                            {note.data.title}
                        </span>
                    ) : (
                        <a href={`/notes/${note.slug}`} class="text-sm text-muted-foreground hover:text-foreground transition-colors">
                            {note.data.title}
                        </a>
                    )}
                </li>
            )
        })}
    </ol>
  </div>
</div>
