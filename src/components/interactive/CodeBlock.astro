---
import { Check, Copy } from '@lucide/astro';

const { class: className, ...props } = Astro.props;
const lang = props['data-language'];
// Determine if this is a code block that needs a header.
// Presence of data-language usually indicates a block, or data-theme.
const isCodeBlock = props['data-theme'] || lang;
---

<div class="group relative">
  {isCodeBlock && (
    <div class="bg-muted flex items-center justify-between px-2 py-1">
      <span class="text-muted-foreground text-sm font-medium lowercase">
        {lang || "code"}
      </span>
      <button
        x-data="{ copied: false }"
        @click="
            const code = $el.closest('.group').querySelector('pre').innerText;
            navigator.clipboard.writeText(code);
            copied = true;
            setTimeout(() => copied = false, 2000);
        "
        class="text-muted-foreground hover:text-accent-foreground hover:bg-accent flex items-center gap-1.5 rounded px-2 py-1 transition-colors"
        aria-label="Copy code"
      >
        <span x-show="!copied">
            <Copy class="h-4 w-4" />
        </span>
        <span x-show="copied" style="display: none;" x-cloak>
            <Check class="h-4 w-4" />
        </span>
      </button>
    </div>
  )}
  <pre
    class:list={[
      className,
      "overflow-x-auto",
      isCodeBlock ? "rounded-t-none" : "mt-4 mb-6 rounded-lg border px-4 py-4 font-mono text-base",
    ]}
    {...props}
  ><slot /></pre>
</div>
