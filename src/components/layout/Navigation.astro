---
import { ChevronDown } from "@lucide/astro"

import ThemeToggle from "../interactive/ThemeToggle.astro"

const primaryNavItems = [{ name: "Notes", href: "/notes" }]

const moreNavItems = [
  { name: "Work", href: "/work" },
  { name: "Tags", href: "/tags" },
  { name: "Categories", href: "/categories" },
]
const { pathname } = Astro.url
const pathSegments = pathname.split("/").filter(Boolean)
const highlightedPath = pathSegments.length <= 1 ? pathname : `/${pathSegments[0]}`

const isActive = (href: string) => {
  if (href === "/") return pathname === "/"
  return highlightedPath === href
}

const isAnySecondaryActive = moreNavItems.some((item) => isActive(item.href))
---

<aside class="my-8">
  <div class="lg:sticky lg:top-20">
    <nav class="relative flex flex-row items-center justify-between px-0 pb-0" id="nav">
      {/* Left: Avatar/Logo */}
      <a href="/" class="group block shrink-0 cursor-pointer select-none">
        <div class="relative w-10 h-10 rounded-full overflow-hidden transition-all duration-200">
          <img
            src="/images/yash/yash-avatar.webp"
            alt="Yash Agarwal"
            class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-110"
            draggable="false"
          />
        </div>
      </a>

      {/* Right: Navigation Links */}
      <div class="flex flex-row items-center gap-1">
        {
          primaryNavItems.map((item) => (
            <a
              href={item.href}
              class:list={[
                "block px-3 py-1 font-medium rounded-md hover:bg-accent hover:text-accent-foreground transition-colors",
                isActive(item.href) ? "text-foreground" : "text-muted-foreground",
              ]}
            >
              {item.name}
            </a>
          ))
        }

        {/* More Dropdown - Alpine.js */}
        <div class="relative" x-data="{ open: false }" @click.outside="open = false">
          <button
            @click="open = !open"
            class:list={[
              "hover:bg-accent hover:text-accent-foreground flex items-center gap-1 rounded-md border-0 px-3 py-1 font-medium ring-0 transition-colors outline-none focus:outline-none focus-visible:ring-0 focus-visible:ring-offset-0",
              isAnySecondaryActive ? "text-foreground" : "text-muted-foreground",
            ]}
            aria-label="More pages"
          >
            More
            <ChevronDown
              class="w-4 h-4 transition-transform duration-200"
              :class="open && 'rotate-180'"
            />
          </button>

          <!-- Dropdown Menu -->
          <div
            x-show="open"
            x-transition
            x-cloak
            class="absolute right-0 mt-1 min-w-[160px] rounded-md border border-border/50 bg-background/80 backdrop-blur-sm shadow-md z-50 p-1 ring-0"
          >
            <ul>
              {
                moreNavItems.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class:list={[
                        "block px-2 py-1.5 text-sm rounded-sm transition-colors font-medium",
                        isActive(item.href)
                          ? "text-foreground bg-accent"
                          : "text-muted-foreground hover:bg-accent hover:text-foreground",
                      ]}
                    >
                      {item.name}
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>

        {/* Theme Toggle */}
        <ThemeToggle />
      </div>
    </nav>
  </div>
</aside>
