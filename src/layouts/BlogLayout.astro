---
import BaseLayout from './BaseLayout.astro';
import { format } from 'date-fns';

interface Props {
  title: string;
  description?: string;
  image?: string;
  createdOn: Date;
  updatedOn?: Date;
  category?: string;
  tags?: string[];
  readingTime?: string;
}

const {
  title,
  description,
  image,
  createdOn,
  updatedOn,
  category,
  tags,
  readingTime,
} = Astro.props;
---

<BaseLayout title={title} description={description} image={image}>
  <div class="container mx-auto px-4 max-w-screen-2xl">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 py-8 lg:py-12">
      {/* Sidebar / Aside - Placeholder for TOC & Navigation */}
      <aside class="hidden lg:block lg:col-span-3">
        <div class="sticky top-24 space-y-8">
          <div>
            <p class="text-sm font-medium text-muted-foreground uppercase tracking-wider mb-4">
              On this page
            </p>
            {/* TODO: Add Table of Contents Component */}
            <div class="text-sm text-muted-foreground italic">
              Table of Contents (Coming Soon)
            </div>
          </div>

          <div>
             <a href="/notes" class="text-sm text-primary hover:underline">
               &larr; Back to Notes
             </a>
          </div>
        </div>
      </aside>

      {/* Main Content */}
      <main class="lg:col-span-7">
        <article class="prose prose-lg dark:prose-invert max-w-none">
          {/* Article Header */}
          <header class="mb-8 not-prose">
            {/* Breadcrumbs Placeholder */}
            <nav class="flex items-center space-x-2 text-sm text-muted-foreground mb-6">
              <a href="/" class="hover:text-foreground">Home</a>
              <span>/</span>
              <a href="/notes" class="hover:text-foreground">Notes</a>
              <span>/</span>
              <span class="text-foreground">{category || 'Uncategorized'}</span>
            </nav>

            <h1 class="text-3xl md:text-4xl lg:text-5xl font-serif font-bold tracking-tight mb-4 text-balanced">
              {title}
            </h1>

            <div class="flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-muted-foreground font-mono">
              <time datetime={createdOn.toISOString()}>
                {format(createdOn, 'MMMM dd, yyyy')}
              </time>

              {readingTime && (
                <>
                  <span>•</span>
                  <span>{readingTime}</span>
                </>
              )}

              {updatedOn && (
                <>
                  <span>•</span>
                  <span class="text-accent-foreground">
                    Updated {format(updatedOn, 'MMM dd, yyyy')}
                  </span>
                </>
              )}
            </div>

            {tags && tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-6">
                {tags.map((tag) => (
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-secondary text-secondary-foreground">
                    #{tag}
                  </span>
                ))}
              </div>
            )}

            <hr class="mt-8 border-border" />
          </header>

          {/* Content Slot */}
          <slot />

          {/* Article Footer */}
          <footer class="mt-12 pt-8 border-t border-border">
            {/* TODO: Add Series Navigation */}
            {/* TODO: Add ConvertKit Form */}
            {/* TODO: Add Comments Component */}
            <div class="p-4 rounded-lg bg-muted/50 text-center text-muted-foreground italic">
              Comments feature coming soon.
            </div>
          </footer>
        </article>
      </main>

      {/* Right Sidebar - Placeholder for future widgets */}
      <aside class="hidden xl:block xl:col-span-2">
        <div class="sticky top-24">
          {/* Placeholder for extra widgets if needed */}
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
